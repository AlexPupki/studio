# ADR 1: Выбор основной СУБД и кэширующего слоя

- **Дата**: 2024-08-23
- **Статус**: Accepted

## Контекст
Платформе "Grand Tour Sochi" требуется надёжное, масштабируемое и гибкое решение для хранения основных бизнес-данных (пользователи, бронирования, контент) и для высокопроизводительных операций (кэширование, сессии, rate limiting).

## Варианты Решений

### Вариант 1: Использовать только NoSQL (например, Firestore)
- **Плюсы**:
  - Отличная масштабируемость и простота для простых схем.
  - Глубокая интеграция со стеком Firebase/Google Cloud.
- **Минусы**:
  - Сложность в реализации сложных запросов с JOIN-ами, которые потребуются для аналитики и отчётов.
  - Транзакционность ограничена.

### Вариант 2: Использовать только SQL (например, PostgreSQL)
- **Плюсы**:
  - Надёжность, ACID-транзакции.
  - Мощный язык запросов для любой аналитики.
  - Зрелая и предсказуемая технология.
- **Минусы**:
  - Может быть избыточен для простых задач, как хранение сессий.
  - Требует больше усилий по администрированию и масштабированию.

### Вариант 3: Гибридный подход (PostgreSQL + Redis)
- **Описание**: PostgreSQL используется как основное хранилище для всех критичных данных, требующих строгой консистентности. Redis используется для временных, но часто запрашиваемых данных: кэш, сессии, rate-limiter, очереди.
- **Плюсы**:
  - Используем сильные стороны каждого инструмента.
  - PostgreSQL обеспечивает надёжность для бизнес-данных.
  - Redis обеспечивает высочайшую производительность для кэша и сессий, снимая нагрузку с основной БД.
- **Минусы**:
  - Некоторое усложнение архитектуры за счёт введения второго хранилища.

## Решение
Мы выбрали **Вариант 3: Гибридный подход (PostgreSQL + Redis)**.
Обоснование: Этот вариант наилучшим образом соответствует требованиям blueprint'а. Он даёт нам надёжность и гибкость для хранения основных данных и одновременно обеспечивает производительность для таких задач, как rate limiting и кэширование, которые критичны для защиты от злоупотреблений и для быстрого отклика системы. Усложнение архитектуры является приемлемым компромиссом ради получения лучших характеристик производительности и надёжности.

## Последствия
- В архитектуру проекта необходимо заложить адаптеры для работы как с PostgreSQL, так и с Redis.
- Для разработки потребуется локальный запуск или доступ к инстансам PostgreSQL и Redis.
- CI/CD пайплайн должен учитывать миграции схемы для PostgreSQL.
