# Политика оповещений (Alerting)

**Версия: 1.0.0**

Этот документ описывает ключевые события, которые должны вызывать оповещения для операционной и технической команды. Цель — проактивно реагировать на возможные проблемы до того, как они затронут клиентов.

Оповещения рекомендуется настраивать через Google Cloud Monitoring, используя метрики на основе логов (Logs-based Metrics).

---

## 1. Критические оповещения (Critical Alerts)

Эти алерты требуют немедленного внимания.

### 1.1. Сбой Cron-задачи `holds-expire`

- **Триггер:** 2 или более последовательных неудачных запусков cron-задачи `/api/jobs/holds/expire`.
- **Источник:** Логи Google Cloud Scheduler или логи приложения, фильтрующие по `jsonPayload.job = "holds-expire"` и статусу `>200`.
- **Канал:** Email на `devops@example.com`, PagerDuty.
- **Причина важности:** Если задача не работает, места не освобождаются, что приводит к финансовым потерям и недоступности слотов для новых клиентов.

### 1.2. Всплеск 5xx ошибок на API бронирования

- **Триггер:** Уровень 5xx ошибок (статус >= 500) на эндпоинтах `/api/booking/*` превышает 2% в течение 5-минутного окна.
- **Источник:** Метрики Google Cloud Run или Logs-based Metrics по `request_logs`.
- **Канал:** Email на `devops@example.com`, PagerDuty.
- **Причина важности:** Высокий уровень ошибок напрямую влияет на способность пользователей бронировать услуги, что ведет к потере дохода.

---

## 2. Предупреждающие оповещения (Warning Alerts)

Эти алерты сигнализируют о потенциальных проблемах, которые требуют внимания, но не являются критическими.

### 2.1. Всплеск ошибок валидации (4xx)

- **Триггер:** Уровень 4xx ошибок (статус 400, 409) на эндпоинтах `/api/booking/*` превышает 10% в течение 15-минутного окна.
- **Источник:** Logs-based Metrics по `request_logs`.
- **Канал:** Сообщение в Slack-канал `#alerts-warning`.
- **Причина важности:** Может указывать на проблемы на стороне клиента (баг в UI, некорректная работа мобильного приложения) или на попытки сканирования API.

### 2.2. Задержка ответа API

- **Триггер:** 95-й перцентиль времени ответа (p95 latency) для эндпоинтов `/api/booking/*` превышает 1500 мс.
- **Источник:** Метрики Google Cloud Run.
- **Канал:** Сообщение в Slack-канал `#alerts-warning`.
- **Причина важности:** Длительные ответы ухудшают пользовательский опыт и могут быть предвестником проблем с производительностью базы данных или внешних сервисов.
