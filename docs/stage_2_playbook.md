# Stage 2: Каталог, Бронирования и Платежи (MVP)

**Цель:** Реализовать основной бизнес-цикл платформы: просмотр услуг, создание бронирования через интеграцию с YCLIENTS и его оплата. Этот этап превращает платформу из простого сайта с аутентификацией в рабочий коммерческий сервис.

---

## 1. Feature Flags и Конфигурация

- **`FEATURE_PAYMENTS_ONLINE`** (ON): Включает интеграцию с платежным провайдером.
- **`FEATURE_SEAT_SHARING`** (OFF): Функционал совместных поездок остается выключенным.
- **`YCLIENTS_API_TOKEN`**: Переменная окружения для хранения токена доступа к API YCLIENTS.
- **`PAYMENT_PROVIDER_KEY`**: Переменная окружения для ключа API платежного шлюза.

---

## 2. Архитектура и Интеграции

- **YCLIENTS Service**:
  - Создать сервис-адаптер `src/lib/server/yclients/` для работы с API YCLIENTS.
  - Реализовать методы:
    - `getServices()`: Получение списка услуг.
    - `getAvailableSlots(serviceId, date)`: Получение доступных временных слотов.
    - `createBooking(bookingDetails)`: Создание бронирования.
  - Вся работа с API должна быть обернута в server-only функции.

- **Payment Service**:
  - Создать интерфейс `IPaymentProvider` в `src/lib/shared/payments.contracts.ts`.
  - Создать сервис-адаптер `src/lib/server/payments/` для работы с платежным шлюзом (например, Stripe или ЮKassa).
  - Реализовать метод `createPayment(amount, orderId)` для создания платежной сессии.

---

## 3. Модель Данных

- **`Service` (Услуга)**: `id`, `title`, `description`, `price`, `duration`, `photos`. Эти данные будут импортироваться из YCLIENTS.
- **`Booking` (Бронирование)**: `id`, `userId`, `serviceId`, `yclientsRecordId`, `slot`, `status` ('pending_payment', 'confirmed', 'cancelled'), `paymentId`.

---

## 4. Пользовательские Сценарии (User Stories)

### 4.1. Каталог Услуг
- **US1**: Как пользователь, я хочу видеть на сайте страницу "Каталог" со списком всех доступных услуг (полеты, поездки).
- **US2**: Для каждой услуги я хочу видеть ее название, краткое описание, цену, длительность и несколько фотографий.

### 4.2. Страница Услуги и Выбор Слота
- **US3**: Как пользователь, я могу перейти на детальную страницу услуги.
- **US4**: На странице услуги я вижу полное описание, галерею фотографий и календарь для выбора даты.
- **US5**: При выборе даты я вижу список доступных временных слотов, полученных из YCLIENTS.

### 4.3. Бронирование и Оплата
- **US6**: После выбора слота я попадаю на страницу оформления заказа, где вижу детали своего выбора.
- **US7**: На странице оформления я нажимаю "Забронировать и оплатить".
- **US8**: Система создает предварительное бронирование в YCLIENTS, а затем перенаправляет меня на страницу оплаты.
- **US9**: После успешной оплаты мое бронирование подтверждается.

---

## 5. UI/UX

- **Страница "Каталог"**: Карточки услуг с фото и основной информацией.
- **Страница "Услуга"**:
    - Галерея изображений.
    - Описание услуги.
    - Компонент календаря (`shadcn/ui/calendar`).
    - Список кнопок для выбора времени.
- **Страница "Оформление заказа"**: Сводка по заказу и кнопка перехода к оплате.
- **Страница "Мои бронирования"** (в /account): Список предстоящих и прошедших бронирований пользователя.

---

## 6. Definition of Done (Критерии готовности)

- [ ] Пользователь может просматривать каталог услуг.
- [ ] Пользователь может выбрать дату и время для бронирования на странице услуги.
- [ ] Создается бронирование в YCLIENTS.
- [ ] Пользователь перенаправляется на (замоканную на данном этапе) страницу оплаты.
- [ ] В личном кабинете на странице `/account/bookings` отображается список бронирований.
- [ ] Весь код, взаимодействующий с внешними API, находится в `src/lib/server/` и помечен `'use server'`.
- [ ] Созданы ADR для выбора платежного провайдера.
