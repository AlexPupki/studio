# Стратегия Тестирования

**Цель:** Обеспечить надежность и предсказуемость ключевых частей приложения, не замедляя разработку избыточными тестами. Мы тестируем поведение, а не каждую строчку кода.

## 1. Философия

- **Тестируем поведение, а не реализацию.**
- **Тесты должны быть быстрыми, надежными и легкими для понимания.**
- **100% покрытие кода — не самоцель.** Мы фокусируемся на критически важных путях.
- **Каждый тест должен проверять один конкретный аспект.**

## 2. Инструменты

- **Unit & Integration тесты:** [Vitest](https://vitest.dev/)
- **E2E (End-to-End) тесты:** [Playwright](https://playwright.dev/)
- **UI-компоненты:** [React Testing Library](https://testing-library.com/docs/react-testing-library/intro/)

## 3. Что мы тестируем

### Unit-тесты (юнит-тесты)
- **Цель:** Проверить отдельные, изолированные функции (юниты).
- **Примеры:**
  - Утилиты для форматирования дат или телефонов (`/lib/shared/*.utils.ts`).
  - Сложные алгоритмы (например, логика расчета цены в будущем).
- **Расположение:** Файлы `*.test.ts` рядом с тестируемым кодом.

### Integration-тесты (интеграционные)
- **Цель:** Проверить, как несколько юнитов работают вместе.
- **Примеры:**
  - **Server Actions:** Это сердце нашей бизнес-логики. Мы мокируем (заменяем) внешние зависимости (например, `db` или `redisClient`), чтобы проверить, что экшен правильно вызывает нужные методы с правильными параметрами.
  - **Взаимодействие с БД:** Проверка Drizzle-запросов и кастомных ограничений (constraints).
- **Расположение:** Файлы `*.test.ts` или `*.spec.ts` рядом с тестируемым кодом.

### E2E-тесты (сквозные)
- **Цель:** Эмулировать полного пользователя, который взаимодействует с реальным приложением в браузере.
- **Примеры:**
  - **Успешный путь бронирования:** Открыть страницу маршрута -> выбрать слот -> заполнить форму -> получить подтверждение.
  - **Проверка ошибок:** Попытка забронировать слот с недостаточной вместимостью.
  - **Проверка доступа:** Попытка зайти в админ-панель `/ops` без прав.
- **Расположение:** Директория `tests/e2e/`.

## 4. Запуск тестов

### Запуск всех юнит- и интеграционных тестов:
```bash
npm run test
```

### Запуск юнит-тестов в режиме наблюдения (watch mode):
```bash
npm run test:watch
```

### Запуск E2E-тестов:
Перед запуском убедитесь, что ваше приложение запущено локально (`npm run dev`).
```bash
npm run test:e2e
```

Для просмотра отчета о выполнении E2E-тестов:
```bash
npx playwright show-report
```

## 5. CI/CD

Все тесты (`npm run test` и `npm run test:e2e`) должны автоматически запускаться в CI/CD пайплайне (например, через GitHub Actions) при каждом пуше в основные ветки. Сборка не должна проходить, если тесты падают.
