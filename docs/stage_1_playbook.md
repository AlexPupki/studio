# Stage 1: Фундамент — Аутентификация и Личные Кабинеты

**Цель:** Создать ядро системы доступа для всех ролей (клиенты, сотрудники, партнеры). На этом этапе мы строим механизм входа, на который будет опираться вся защищенная часть приложения.

## Задачи (Декомпозиция)

### Шаг 1: Проектирование и реализация системы аутентификации

- **Задача:** Разработать безопасный механизм входа по номеру телефона.
- **Логика:**
  - Пользователь вводит номер телефона.
  - Система (пока в виде заглушки) "отправляет" SMS с кодом подтверждения. На самом деле, мы будем просто выводить код в консоль сервера для отладки.
  - Пользователь вводит полученный код.
  - Сервер проверяет код и, в случае успеха, создает зашифрованную cookie-сессию, идентифицирующую пользователя.
- **Компоненты и Экшены:**
  - [ ] Создать страницу входа `src/app/login/page.tsx` с формой для ввода номера телефона.
  - [ ] Создать серверный экшен `requestLoginCodeAction(phone)`.
  - [ ] Создать страницу верификации `src/app/login/verify/page.tsx` с формой для ввода кода.
  - [ ] Создать серверный экшен `verifyLoginCodeAction(phone, code)`.

### Шаг 2: Создание базового Личного Кабинета

- **Задача:** Создать защищенную страницу `/account`, доступную только для аутентифицированных пользователей.
- **Логика:**
  - Страница `/account` должна проверять наличие валидной сессии.
  - Если пользователь не вошел, его должно перенаправлять на страницу `/login`.
  - Если вошел — показывать базовую информацию о его аккаунте.
- **Компоненты и Экшены:**
  - [ ] Создать страницу `src/app/account/page.tsx`.
  - [ ] Реализовать в ней вызов экшена `getAccountDetailsAction`, который мы уже спроектировали.
  - [ ] Отобразить на странице имя пользователя, его статус в клубе и историю записей.
  - [ ] Добавить на страницу кнопку "Выйти", которая будет удалять сессию.

### Шаг 3: Интеграция аутентификации в основной макет

- **Задача:** Обновить `MainLayout`, чтобы он динамически отображал состояние "Войти" или "Выйти".
- **Логика:**
  - `MainLayout` должен знать, аутентифицирован ли текущий пользователь.
  - Вместо статичной кнопки "Войти", он должен показывать либо ее, либо имя пользователя и кнопку "Выйти".

## Что не входит в Stage 1:

- Создание публичной витрины услуг и блога (этим мы займемся в Stage 2, когда будет готов фундамент).
- Разделение на роли (сотрудник, партнер). Пока все вошедшие пользователи считаются клиентами.
- Админ-панель для управления контентом.
- Отправка реальных SMS.

После завершения этого этапа у нас будет работающее ядро системы с возможностью безопасного входа и защищенной зоной. Это идеальный фундамент для дальнейшего расширения.
